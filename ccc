#!/usr/bin/env bash
# Claude Code Commander (ccc2) for CCP 2.0
# ÂàáÊç¢ profile Âπ∂ÂêØÂä® Claude Code

set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]:-$0}")" && pwd)"
CCP2_CMD_DEFAULT="${SCRIPT_DIR}/ccp.sh"
CCP2="${CCP2_CMD:-$CCP2_CMD_DEFAULT}"

usage() {
    cat << 'EOF'
Usage: ./ccc2 <profile> [claude-options]

Examples:
  ./ccc2 work                              # Switch to 'work' profile and launch
  ./ccc2 personal --dangerously-skip-permissions  # With Claude options

Available commands:
  ccp2 add <name>     # Add new profile
  ccp2 list           # List all profiles
  ccp2 status         # Show current status
EOF
}

if [[ ! -f "$CCP2" ]]; then
    echo "ccc2 error: cannot find ccp2 script at $CCP2" >&2
    exit 1
fi

if [[ $# -lt 1 ]]; then
    usage
    exit 1
fi

profile="$1"
shift || true

# Remaining args are passed to claude
claude_args=("$@")

# Apply profile environment
eval "$($CCP2 "$profile" 2>/dev/null)"

# Show status
echo ""
echo "üöÄ Launching Claude Code..."
echo "   Profile: $profile"
echo "   Base URL: ${ANTHROPIC_BASE_URL:-'(not set)'}"
echo ""

# Ensure claude is available
if ! command -v claude >/dev/null 2>&1; then
    echo "‚ùå 'claude' CLI not found. Install: npm install -g @anthropic-ai/claude-code" >&2
    exit 127
fi

# Launch Claude Code
if [[ ${#claude_args[@]} -eq 0 ]]; then
    exec claude
else
    exec claude "${claude_args[@]}"
fi
